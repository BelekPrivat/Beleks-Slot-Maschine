<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<title>ğŸ° BelekÂ´s Slot-Maschine</title>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>

<style>
html,body{margin:0;padding:0;height:100%;background:#111;color:white;font-family:Arial}
#layout{display:flex;height:100vh}
#app{width:55%;display:flex;justify-content:center;align-items:center}
#gameCard{background:#000;border:3px solid gold;border-radius:20px;padding:28px 34px;display:flex;flex-direction:column;align-items:center;gap:14px;min-width:420px}
h1{color:gold;font-size:2.4rem}
.status{color:cyan}
.jackpot{color:gold;font-size:1.8rem}
.reels{display:flex;gap:25px}
.reel{width:95px;font-size:4.5rem;background:#000;padding:18px;border:5px ridge gold;text-align:center}
.controls{display:flex;gap:10px}
.controls button{padding:12px 18px;font-size:1rem;border:none;border-radius:10px;cursor:pointer}
.spin{background:green;color:white}
.allin{background:red;color:white}
.player-info{font-size:1.2rem;color:cyan}
#right{width:45%;background:black;border-left:4px solid gold;padding:12px;display:flex;flex-direction:column;gap:12px}
.panel{background:#000;border:2px solid gold;border-radius:12px;padding:10px}
.panel h3{text-align:center;color:gold}
#leaderboardList div{display:flex;justify-content:space-between;padding:6px;border-bottom:1px solid #333}
.lb-self{border-left:3px solid cyan}
#winLog{max-height:260px;overflow-y:auto}
.log-win{color:#00ff7f}.log-lose{color:#ff4c4c}.log-jackpot{color:gold}
</style>
</head>

<body>
<div id="layout">
<div id="app">
<div id="gameCard">
<h1>ğŸ° BelekÂ´s Slot-Maschine ğŸ°</h1>
<div id="status" class="status"></div>
<div id="jackpot" class="jackpot"></div>
<div id="timer" class="status"></div>

<div class="reels">
<div class="reel" id="r1">â”</div>
<div class="reel" id="r2">â”</div>
<div class="reel" id="r3">â”</div>
</div>

<div class="controls">
<button onclick="setBet()">ğŸ¯ Einsatz</button>
<button class="allin" onclick="allIn()">ğŸ’¥ ALL IN</button>
<button class="spin" onclick="spin()">â–¶ SPIN</button>
</div>

<div id="playerInfo" class="player-info"></div>
</div>
</div>

<div id="right">
<div class="panel"><h3>ğŸ† Leaderboard</h3><div id="leaderboardList"></div></div>
<div class="panel"><h3>ğŸ§¾ Gewinne</h3><div id="winLog"></div></div>
</div>
</div>

<script>
/* ===== FIREBASE ===== */
firebase.initializeApp({
 apiKey: "AIzaSyA8LYHHlfOwdODHC5Eo-hzWM5pABvvJJlY",
 authDomain: "slot-maschine-2.firebaseapp.com",
 projectId: "slot-maschine-2"
});

const auth=firebase.auth();
const db=firebase.firestore();
auth.signInAnonymously();

/* ===== GAME VARS ===== */
const SYMBOLS=["ğŸ’","ğŸ‹","ğŸŠ","ğŸ””","â­","7ï¸âƒ£","ğŸ’"];
const PAYTABLE={"ğŸ’":10,"ğŸ‹":30,"ğŸŠ":50,"ğŸ””":75,"â­":100,"7ï¸âƒ£":150};
const INCOME_PER_MIN=50,INTERVAL=60000;

const jackpotRef=db.collection("game").doc("jackpot");

let playerName=localStorage.getItem("player_name")||prompt("Spielername:");
localStorage.setItem("player_name",playerName);

let data={balance:5000,bet:50,lastIncome:Date.now()};
let jackpotValue=5000,spinning=false,winLog=[];

/* ===== INIT ===== */
async function init(){
 const jp=await jackpotRef.get();
 if(jp.exists) jackpotValue=jp.data().value;
 else await jackpotRef.set({value:jackpotValue});

 const ref=db.collection("players").doc(playerName);
 const d=await ref.get();
 if(d.exists) data={...data,...d.data()};
 else await ref.set(data);

 updateUI();
 loadLeaderboard();
}
init();

/* ===== LEADERBOARD ===== */
async function loadLeaderboard(){
 const snap=await db.collection("players").orderBy("balance","desc").limit(10).get();
 leaderboardList.innerHTML="";
 snap.forEach(d=>{
  const self=d.id===playerName?" lb-self":"";
  leaderboardList.innerHTML+=`
   <div class="${self}">
    <span>${d.id}</span>
    <span>${d.data().balance} â‚¬</span>
   </div>`;
 });
}
setInterval(loadLeaderboard,5000);

/* ===== EINKOMMEN ===== */
setInterval(async()=>{
 const now=Date.now();
 if(data.balance<5000){
  const diff=Math.floor((now-data.lastIncome)/INTERVAL);
  if(diff>0){
   data.balance=Math.min(5000,data.balance+diff*INCOME_PER_MIN);
   data.lastIncome+=diff*INTERVAL;
   await savePlayer();
  }
  timer.innerText=`â³ +50â‚¬ in ${Math.ceil((INTERVAL-(now-data.lastIncome))/1000)}s`;
 }else timer.innerText="âœ… Maximales Einkommen erreicht";
 updateUI();
},1000);

/* ===== SPIN ===== */
function randomSym(){return SYMBOLS[Math.floor(Math.random()*SYMBOLS.length)]}
async function spin(){
 if(spinning||data.balance<data.bet)return;
 spinning=true;

 data.balance-=data.bet;
 jackpotValue+=data.bet;
 await jackpotRef.set({value:jackpotValue});

 const f1=randomSym(),f2=randomSym(),f3=randomSym();
 animate(r1,f1,600);animate(r2,f2,800);animate(r3,f3,1000);

 setTimeout(async()=>{
  if(f1===f2&&f2===f3){
   if(f1==="ğŸ’"){
    data.balance+=jackpotValue;
    jackpotValue=5000;
    await jackpotRef.set({value:jackpotValue});
    log("ğŸ’ JACKPOT!","jackpot");
   }else{
    const win=data.bet*PAYTABLE[f1];
    data.balance+=win;
    log(`ğŸ‰ Gewinn +${win}â‚¬`,"win");
   }
  }else log("âŒ Kein Gewinn","lose");

  await savePlayer();
  updateUI();
  spinning=false;
 },1100);
}

/* ===== UTIL ===== */
function animate(r,s,d){
 const st=Date.now();
 const i=setInterval(()=>{
  r.innerText=randomSym();
  if(Date.now()-st>=d){clearInterval(i);r.innerText=s;}
 },70);
}
function log(t,type){
 const c=type==="lose"?"log-lose":type==="jackpot"?"log-jackpot":"log-win";
 winLog.unshift(`<div class="${c}">${t}</div>`);
 winLog=winLog.slice(0,12);
 winLogEl.innerHTML=winLog.join("");
}
function updateUI(){
 status.innerText=`ğŸ‘¤ ${playerName}`;
 jackpot.innerText=`ğŸ’ JACKPOT: ${jackpotValue} â‚¬`;
 playerInfo.innerText=`ğŸ’° ${data.balance} â‚¬ | ğŸ¯ Einsatz ${data.bet} â‚¬`;
}
function setBet(){
 const v=parseInt(prompt("Einsatz:",data.bet));
 if(v>=50&&v<=data.balance)data.bet=v;
}
function allIn(){
 if(data.balance<50)return alert("âŒ Kein Guthaben");
 data.bet=data.balance;
}
async function savePlayer(){
 await db.collection("players").doc(playerName).set(data,{merge:true});
}
</script>
</body>
</html>
